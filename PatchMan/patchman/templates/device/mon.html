<%inherit file="/base/index.html" />
<%block name="head">
<script src="${request.static_url('patchman:static/js/datefmt.js')}"></script>
<script type="text/javascript">

$(document).ready(function(){
        var logsLi =  $("#logs li");
        var logs = $( "#logs");
        var insertLog = function(i, l ) {
                var element = 
                "<li class='new'>"+
                l.p+": " +fmt.format(new Date(l.t))+ 
                "</li>" ;
                d = items.push(element);
            }
        var logResponse = function( data ) {
            var items = [];
            fmt = new DateFmt("%d/%m/%y %H:%M");
            if (data.length) {
                $.each( data, insertLog);
                logsLi.removeClass("new"); 
                logs.prepend(items.join( "" ));
            }
        };
        var logFrame = function() {
            console.log("load");
            $.getJSON( "${request.route_url('log_get')}", logResponse);    
        };

        $('.stream').bind('load', logFrame);  
});    

</script>

</%block>

<div class="page-header">
  	<h1>${device.name}</h1>
</div>

<div class="row show-grid">
	<div class="span6">
		<h4>Monitor</h4>
        <img src="http://localhost:8080/stream" width="320" alt="cam" class="stream" />
</div>
	<div class="span6">
		<h4>Historial</h4>
        <div id="logs"></div>
    </div>
</div>
